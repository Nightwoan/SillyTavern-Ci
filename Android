#!/system/bin/bash

# 检查是否已经安装了Ubuntu
if [ ! -d /data/data/com.termux/files/usr/bin/ubuntud ] ; then
  echo "正在安装Ubuntu..."
  apt update && apt install -y ubuntu-pro
  echo "Ubuntu安装完成！"
fi

# 进入Ubuntu环境
ubuntud

# 检查是否已经安装了Node.js
if ! dpkg -l nodejs | grep -q 'ii'; then
  echo "正在安装Node.js..."
  apt install -y nodejs npm
  echo "Node.js安装完成！"
else
  echo "Node.js已安装，版本为: $(dpkg -l nodejs | grep 'ii' | awk '{print $3}')"
fi

# 检查是否已经安装了vim
if ! dpkg -l vim | grep -q 'ii'; then
  echo "正在安装vim..."
  apt install -y vim
  echo "vim安装完成！"
else
  echo "vim已安装，版本为: $(dpkg -l vim | grep 'ii' | awk '{print $3}')"
fi

# 检查是否已经安装了SillyTavern
if [ ! -d /data/data/com.termux/files/usr/bin/SillyTavern ]; then
  echo "正在安装SillyTavern..."
  git clone https://github.com/SillyTavern/SillyTavern.git
  cd SillyTavern
  npm install
  echo "SillyTavern安装完成！"
else
  echo "SillyTavern已安装，版本为: $(cd SillyTavern; npm -v)"
fi

echo "环境部署完成"
